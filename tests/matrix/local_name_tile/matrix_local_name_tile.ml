open Optitrust
open Prelude

let _ = Flags.check_validity := true
let _ = Flags.recompute_resources_between_steps := true
let _ = Run.script_cpp (fun _ ->
  (* let range a b = (trm_int a, trm_int b) in *)
  !! Matrix.local_name_tile ~alloc_instr:[cVarDef "a"] ~var:"a" ~local_var:"y_local"
    (* [range 0 10; range 2 10; range 0 4] *)
    [occLast; cFor ~body:[cArrayWrite "a"] "i"];
  (* FIXME: arith exprs are not syntactically equal
  !! Matrix.local_name_tile ~alloc_instr:[cVarDef "b"] ~delete:true ~var:"b" ~local_var:"y"
    (* [range 0 10; range 2 10; range 0 4] *)
    [cFor ~body:[cArrayWrite "b"] "j"];

  !! Matrix.local_name_tile ~alloc_instr:[cVarDef "c"] ~delete:true ~var:"c" ~local_var:"z"
    (* [(var "i", trm_int 1); range 2 10; range 0 4] *)
    [cFor ~body:[cArrayWrite "c"] "j"];
    *)
)
